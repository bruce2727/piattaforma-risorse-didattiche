<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Piattaforma Risorse Didattiche</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f9f9f9; }
    header { background: #4a90e2; color: #fff; padding: 15px; }
    header h1 { margin: 0; font-size: 20px; }
    nav { background: #eee; padding: 10px; display: flex; gap: 15px; }
    nav a { font-weight: bold; cursor: pointer; text-decoration: none; }
    nav a.active { color: #4a90e2; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); gap: 15px; padding: 20px; }
    .card { background: #fff; border: 1px solid #ccc; border-radius: 8px; padding: 15px; display: flex; flex-direction: column; justify-content: space-between; }
    .card h3 { margin: 0 0 8px; }
    .card p { margin: 0 0 10px; font-size: 14px; color: #555; }
    .card button { margin-top: auto; padding: 8px; border: none; border-radius: 5px; cursor: pointer; }
    .btn-primary { background: #4a90e2; color: #fff; }
    .btn-danger { background: #dc3545; color: #fff; }
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,.6); justify-content: center; align-items: center; }
    .modal-content { background: #fff; padding: 20px; border-radius: 8px; width: 90%; max-width: 600px; }
    .modal-content label { display: block; margin-top: 10px; }
    .modal-content input, .modal-content textarea, .modal-content select { width: 100%; padding: 8px; margin-top: 5px; }
  </style>
</head>
<body>
  <header>
    <h1>Piattaforma Risorse Didattiche</h1>
  </header>

  <nav>
    <a id="navResources" class="active" onclick="showSection('resources')">Risorse</a>
    <a id="navPlaylists" onclick="showSection('playlists')">Minicorsi</a>
  </nav>

  <!-- Risorse -->
  <section id="resourcesSection">
    <main id="resourceGrid" class="grid"></main>
    <button class="btn-primary" onclick="openResourceModal()">＋ Aggiungi Risorsa</button>
  </section>

  <!-- Minicorsi -->
  <section id="playlistsSection" style="display:none;">
    <main id="playlistGrid" class="grid"></main>
    <button class="btn-primary" onclick="openPlaylistModal()">＋ Aggiungi Minicorso</button>
  </section>

  <!-- Modale Risorse -->
  <div id="resourceModal" class="modal">
    <div class="modal-content">
      <h2 id="resourceModalTitle">Aggiungi Risorsa</h2>
      <label>Titolo</label><input id="resTitle" type="text" />
      <label>Descrizione</label><textarea id="resDesc"></textarea>
      <label>Categoria</label>
      <select id="resCategory">
        <option>Coding</option>
        <option>Intelligenza Artificiale</option>
        <option>Stampa 3D</option>
        <option>UdA</option>
        <option>Storytelling e Multimedia</option>
        <option>Metodologie didattiche</option>
        <option>App per l'inclusione</option>
      </select>
      <label>Grado</label>
      <select id="resGrade">
        <option>Infanzia</option>
        <option>Primaria</option>
        <option>Secondaria di primo grado</option>
        <option>Tutti i gradi</option>
      </select>
      <label>Tipo</label>
      <select id="resType">
        <option value="text">Testo</option>
        <option value="video">Video</option>
        <option value="link">Link</option>
      </select>
      <label>Contenuto</label><textarea id="resContent"></textarea>
      <label>Tag</label><input id="resTags" type="text" placeholder="separa con virgola" />
      <button class="btn-primary" onclick="saveResource()">Salva</button>
      <button onclick="closeModal('resourceModal')">Chiudi</button>
    </div>
  </div>

  <!-- Modale Minicorsi -->
  <div id="playlistModal" class="modal">
    <div class="modal-content">
      <h2 id="playlistModalTitle">Aggiungi Minicorso</h2>
      <label>Titolo</label><input id="playlistTitle" type="text" />
      <label>Descrizione</label><textarea id="playlistDesc"></textarea>
      <label>Categoria</label>
      <select id="playlistCategory">
        <option>Coding</option>
        <option>Intelligenza Artificiale</option>
        <option>Stampa 3D</option>
        <option>UdA</option>
        <option>Storytelling e Multimedia</option>
        <option>Metodologie didattiche</option>
        <option>App per l'inclusione</option>
      </select>
      <label>Risorse (ID separati da virgola)</label><input id="playlistRes" type="text" />
      <button class="btn-primary" onclick="savePlaylist()">Salva</button>
      <button onclick="closeModal('playlistModal')">Chiudi</button>
    </div>
  </div>

<script>
  const API_BASE = "https://piattaforma-risorse-didattiche.onrender.com/api";

  // --- Gestione sezioni ---
  function showSection(section) {
    document.getElementById("resourcesSection").style.display = section === "resources" ? "block" : "none";
    document.getElementById("playlistsSection").style.display = section === "playlists" ? "block" : "none";
    document.getElementById("navResources").classList.toggle("active", section === "resources");
    document.getElementById("navPlaylists").classList.toggle("active", section === "playlists");
    if (section === "resources") loadResources();
    else loadPlaylists();
  }

  // --- RISORSE ---
  async function loadResources() {
    const res = await fetch(`${API_BASE}/risorse`);
    const data = await res.json();
    const grid = document.getElementById("resourceGrid");
    grid.innerHTML = "";
    data.forEach(r => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h3>${r.titolo}</h3>
        <p>${r.descrizione}</p>
        <small>${r.categoria} | ${r.grado}</small>
        <button class="btn-primary" onclick="openResource(${r.id}, '${r.tipo}', '${r.contenuto}')">Apri</button>
        <button onclick="editResource(${r.id})">Modifica</button>
        <button class="btn-danger" onclick="deleteResource(${r.id})">Elimina</button>
      `;
      grid.appendChild(card);
    });
  }

  async function saveResource() {
    const res = {
      titolo: document.getElementById("resTitle").value,
      descrizione: document.getElementById("resDesc").value,
      categoria: document.getElementById("resCategory").value,
      grado: document.getElementById("resGrade").value,
      tipo: document.getElementById("resType").value,
      contenuto: document.getElementById("resContent").value,
      tag: document.getElementById("resTags").value
    };
    await fetch(`${API_BASE}/risorse`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(res)
    });
    closeModal("resourceModal");
    loadResources();
  }

  async function editResource(id) {
    alert("Da implementare: apertura modale con valori esistenti e PUT verso backend con id " + id);
  }

  async function deleteResource(id) {
    if (confirm("Vuoi eliminare questa risorsa?")) {
      await fetch(`${API_BASE}/risorse/${id}`, { method: "DELETE" });
      loadResources();
    }
  }

  // --- MINICORSI ---
  async function loadPlaylists() {
    const res = await fetch(`${API_BASE}/minicorsi`);
    const data = await res.json();
    const grid = document.getElementById("playlistGrid");
    grid.innerHTML = "";
    data.forEach(p => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h3>${p.titolo}</h3>
        <p>${p.descrizione}</p>
        <small>${p.categoria}</small>
        <button class="btn-primary" onclick="alert('Apri minicorso: ${p.titolo}')">Apri</button>
        <button onclick="editPlaylist(${p.id})">Modifica</button>
        <button class="btn-danger" onclick="deletePlaylist(${p.id})">Elimina</button>
      `;
      grid.appendChild(card);
    });
  }

  async function savePlaylist() {
    const p = {
      titolo: document.getElementById("playlistTitle").value,
      descrizione: document.getElementById("playlistDesc").value,
      categoria: document.getElementById("playlistCategory").value,
      risorse: document.getElementById("playlistRes").value
    };
    await fetch(`${API_BASE}/minicorsi`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(p)
    });
    closeModal("playlistModal");
    loadPlaylists();
  }

  async function editPlaylist(id) {
    alert("Da implementare: apertura modale con valori esistenti e PUT verso backend con id " + id);
  }

  async function deletePlaylist(id) {
    if (confirm("Vuoi eliminare questo minicorso?")) {
      await fetch(`${API_BASE}/minicorsi/${id}`, { method: "DELETE" });
      loadPlaylists();
    }
  }

  // --- Utils ---
  function openResource(id, tipo, contenuto) {
    let html = `<h2>Risorsa ${id}</h2>`;
    if (tipo === "text") html += `<p>${contenuto}</p>`;
    if (tipo === "video") {
      let url = contenuto;
      if (url.includes("watch?v=")) url = url.replace("watch?v=","embed/");
      html += `<iframe width="100%" height="400" src="${url}" allowfullscreen></iframe>`;
    }
    if (tipo === "link") html += `<a href="${contenuto}" target="_blank">${contenuto}</a>`;
    document.getElementById("resourceGrid").innerHTML = html;
  }

  function openResourceModal() {
    document.getElementById("resourceModal").style.display = "flex";
  }
  function openPlaylistModal() {
    document.getElementById("playlistModal").style.display = "flex";
  }
  function closeModal(id) {
    document.getElementById(id).style.display = "none";
  }

  // --- Avvio iniziale
  loadResources();
</script>
</body>
</html>





