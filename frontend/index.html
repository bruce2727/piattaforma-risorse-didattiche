<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Piattaforma Risorse Didattiche</title>
<style>
:root {
  --primary:#4a90e2; --success:#28a745; --danger:#dc3545;
  --bg:#f9f9f9; --text:#333; --muted:#555; --border:#ddd;
}
body {font-family:Arial,Helvetica,sans-serif;margin:0;background:var(--bg);color:var(--text);}
header {background:var(--primary);color:#fff;padding:15px 20px;}
header h1 {margin:0;font-size:20px;}
header h2 {margin:5px 0 10px;font-size:15px;font-weight:normal;color:#e1ecff;}
nav {background:#eee;padding:10px 20px;display:flex;gap:16px;}
nav a {font-weight:bold;color:#333;text-decoration:none;padding:6px 0;border-bottom:2px solid transparent;}
nav a.active {color:var(--primary);border-color:var(--primary);}
.filters {background:#fff;padding:10px;border-bottom:1px solid var(--border);display:flex;gap:10px;flex-wrap:wrap;}
.filters select {padding:6px;border:1px solid #ccc;border-radius:4px;}
.grid {display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;padding:20px;}
.card {background:#fff;border:1px solid var(--border);border-radius:8px;padding:14px;display:flex;flex-direction:column;}
.card h3 {margin:0;font-size:18px;}
.card p {margin:6px 0 10px;color:#555;font-size:14px;}
.card .btn {padding:9px;border:none;border-radius:4px;background:var(--primary);color:#fff;cursor:pointer;}
.card .btn + .btn {margin-top:6px;}
.btn-danger {background:var(--danger)!important;}
.btn-plain {background:#fff;border:1px solid var(--primary);color:var(--primary);}
.admin-panel {position:fixed;bottom:20px;right:20px;display:none;}
.menu-btn {background:var(--success);color:#fff;border:none;padding:12px 16px;border-radius:50%;font-size:20px;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.15);}
.admin-menu {display:none;position:absolute;bottom:60px;right:0;background:#fff;border:1px solid var(--border);border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.2);padding:6px;flex-direction:column;gap:6px;}
.admin-menu button {background:#fff;border:1px solid var(--primary);color:var(--primary);padding:8px;border-radius:6px;cursor:pointer;text-align:left;width:160px;}
.login-box {position:fixed;top:15px;right:15px;background:#fff;padding:10px;border:1px solid var(--border);border-radius:8px;display:flex;gap:8px;}
.login-box input {padding:8px;border:1px solid #ccc;border-radius:6px;}
.login-box button {padding:8px 12px;border:none;border-radius:6px;background:var(--primary);color:#fff;cursor:pointer;}
.modal {display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);justify-content:center;align-items:center;z-index:1200;}
.modal-content {background:#fff;padding:20px;border-radius:10px;width:90%;max-width:600px;}
.close-btn {float:right;border:none;background:#fff;color:var(--primary);border:1px solid var(--primary);border-radius:5px;padding:6px 10px;cursor:pointer;}
#loader {display:none;position:fixed;inset:0;background:rgba(255,255,255,.8);z-index:1500;justify-content:center;align-items:center;flex-direction:column;font-size:18px;color:var(--primary);}
.spinner {border:6px solid #f3f3f3;border-top:6px solid var(--primary);border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite}
@keyframes spin {100%{transform:rotate(360deg)}}
</style>
</head>
<body>

<header>
  <h1>Piattaforma Risorse Didattiche</h1>
  <h2>a cura della Comunità di Pratiche dell'Istituto Comprensivo 3 di Alghero</h2>
</header>

<nav>
  <a id="navResources" class="active" onclick="showSection('resources')">Risorse</a>
</nav>

<section id="resourcesSection">
  <div class="filters">
    <select id="categoryFilter">
      <option value="">Tutte le categorie</option>
      <option>Coding</option>
      <option>Intelligenza Artificiale</option>
      <option>Stampa 3D</option>
      <option>UdA</option>
    </select>
    <select id="gradeFilter">
      <option value="">Tutti i gradi</option>
      <option>Infanzia</option>
      <option>Primaria</option>
      <option>Secondaria di primo grado</option>
    </select>
  </div>
  <main id="resourceGrid" class="grid"></main>
</section>

<div id="loader">
  <div class="spinner"></div>
  <div>Caricamento delle risorse in corso...</div>
</div>

<div id="loginBox" class="login-box">
  <input id="adminPass" type="password" placeholder="Password admin">
  <button onclick="adminLogin()">Login</button>
</div>

<div id="adminPanel" class="admin-panel">
  <button class="menu-btn" onclick="toggleAdminMenu()">＋</button>
  <div id="adminMenu" class="admin-menu">
    <button onclick="openResourceModal()">➕ Nuova Risorsa</button>
  </div>
</div>

<div id="resourceModal" class="modal">
  <div class="modal-content">
    <button class="close-btn" onclick="closeModal('resourceModal')">Chiudi</button>
    <h2>Nuova Risorsa</h2>
    <label>Titolo</label><input id="resTitle" type="text">
    <label>Descrizione</label><textarea id="resDesc"></textarea>
    <label>Categoria</label><select id="resCategory"><option>Coding</option><option>Intelligenza Artificiale</option></select>
    <label>Grado</label><select id="resGrade"><option>Infanzia</option><option>Primaria</option><option>Secondaria di primo grado</option></select>
    <label>Tag</label><input id="resTags" type="text">
    <label>Tipo</label><select id="resType"><option value="testo">Testo</option><option value="video">Video</option><option value="link">Link</option></select>
    <label>Contenuto</label><textarea id="resContent"></textarea>
    <button class="btn" onclick="saveResource()">Salva</button>
  </div>
</div>

<script>
const apiBase = "https://piattaforma-risorse-didattiche.onrender.com/api";
const $ = id => document.getElementById(id);
let isAdmin = false;
let resources = [];

async function loadResources() {
  $("loader").style.display = "flex";
  try {
    const res = await fetch(apiBase + "/risorse");
    const data = await res.json();
    resources = Array.isArray(data) ? data : [];
    renderResources();
  } catch (err) {
    alert("Errore nel caricamento delle risorse. Controlla la console.");
    console.error("Errore:", err);
  } finally {
    $("loader").style.display = "none";
  }
}

async function saveResource() {
  const payload = {
    titolo: $("resTitle").value.trim(),
    descrizione: $("resDesc").value.trim(),
    categoria: $("resCategory").value.trim(),
    grado: $("resGrade").value.trim(),
    tag: $("resTags").value.trim(),
    tipo: $("resType").value.trim(),
    contenuto: $("resContent").value.trim()
  };
  Object.keys(payload).forEach(k => { if(payload[k] === "") delete payload[k]; });

  try {
    const res = await fetch(apiBase + "/risorse", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });

    if (!res.ok) {
      const errText = await res.text();
      console.error("Errore backend:", errText);
      alert("Errore nel salvataggio della risorsa. Controlla la console.");
      return;
    }

    await res.json();
    closeModal("resourceModal");
    await loadResources();
  } catch (err) {
    console.error("Errore:", err);
    alert("Errore nel salvataggio della risorsa. Controlla la console.");
  }
}

function renderResources() {
  const grid = $("resourceGrid");
  grid.innerHTML = "";
  const cat = $("categoryFilter").value;
  const grade = $("gradeFilter").value;
  resources
    .filter(r => (!cat || r.categoria === cat) && (!grade || r.grado === grade))
    .forEach(r => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h3>${r.titolo}</h3>
        <p>${r.descrizione}</p>
        <small>${r.categoria} | ${r.grado}</small>
        <button class="btn" onclick="alert('Apri risorsa: ${r.titolo}')">Apri</button>
      `;
      grid.appendChild(card);
    });
}

function openResourceModal() {
  $("resourceModal").style.display = "flex";
  ["resTitle","resDesc","resTags","resContent"].forEach(id => $(id).value = "");
}

function closeModal(id){ $(id).style.display="none"; }
function toggleAdminMenu(){
  const menu = $("adminMenu");
  menu.style.display = menu.style.display==="flex" ? "none" : "flex";
}
function adminLogin(){
  if($("adminPass").value==="admin123"){
    isAdmin=true;
    $("loginBox").style.display="none";
    $("adminPanel").style.display="block";
  } else alert("Password errata");
}

$("categoryFilter").addEventListener("change",renderResources);
$("gradeFilter").addEventListener("change",renderResources);

loadResources();
</script>
</body>
</html>














